<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>å‡ºè·æ¤œæŸ»æˆç¸¾æ›¸ ã‚ªãƒ¼ã‚¯ãƒå°‚ç”¨ MB-66V</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    html, body { background:#e7e7e7; margin:0; padding:0; font-family:Arial, "Yu Gothic UI", Meiryo, sans-serif; font-size:3.5mm; height:100%; }
    .no-print { display: initial; } .print-text { display: none; }
    input, select { font-size:3.2mm; padding:.5mm; box-sizing:border-box; font-family:inherit; }
    input[type="date"] { -webkit-appearance:none; appearance:none; line-height:1.2; }

    table input, table input[type="date"], .td-measure-grid input {
      border:none; outline:none; background:transparent; box-shadow:none; border-radius:0;
      padding:0 1mm; width:100%; height:100%; box-sizing:border-box; -webkit-appearance:none; appearance:none;
    }
    table input:focus, table input[type="date"]:focus { outline:none; box-shadow:none; }

    @media screen { html, body { display:flex; flex-direction:column; align-items:center; } .b5-preview { margin:12mm 0; } }
    .b5-preview { background:#fff; width:176mm; max-width:98vw; margin:10mm auto; padding:8mm; box-shadow:0 0 5mm rgba(0,0,0,.25); box-sizing:border-box; }

    h2 { text-align:center; font-size:7mm; margin-bottom:8mm; }

    table { width:100%; border-collapse:collapse; margin-bottom:4mm; }
    th, td { border:.3mm solid #333; padding:1.2mm 1mm; text-align:center; background:#fff; vertical-align:middle; }
    th { background:#f0f0f0; }
    .section-label { text-align:left; font-weight:bold; background:#f9f9f9; }
    .header-table td, .header-table th { white-space:nowrap; word-break:keep-all; }
    .header-table input { min-width:0; }

    .td-measure { padding:0 !important; }
    .td-measure-grid { display:grid; grid-template-columns:1fr auto; align-items:center; gap:1mm; }
    .td-measure-grid input { text-align:right; }

    .inputter-row { display:flex; align-items:center; gap:2mm; margin-bottom:3mm; }
    .inputter-row label { width:12mm; font-weight:bold; }
    .inputter-row select { width:30%; }

    .stamp-box-row { display:flex; justify-content:flex-end; gap:4mm; margin-top:3mm; }
    .stamp-box-row>div { display:flex; flex-direction:column; align-items:center; }
    .stamp-label { font-size:3mm; margin-bottom:1mm; text-align:center; }
    .signature-box { width:15mm; height:15mm; border:.3mm solid #333; border-radius:2mm; background:#fafbfc; display:flex; align-items:center; justify-content:center; overflow:hidden; }
    .signature-box img { width:9mm; height:9mm; object-fit:contain; }

    .company-name { text-align:right; margin:2mm 1mm 0; font-weight:bold; }
    .order-no-row .section-label { width:15%; } .order-no-row .data { width:85%; }

    .toolbar {
      position:fixed; top:12px; left:50%; transform:translateX(-50%);
      display:flex; gap:8px; padding:8px 10px; background:rgba(255,255,255,0.92);
      border:1px solid #ddd; border-radius:12px; box-shadow:0 2px 18px rgba(0,0,0,.12); z-index:9999; backdrop-filter:blur(4px);
    }
    .toolbar button { font-family:inherit; font-size:14px; padding:8px 14px; border-radius:8px; border:1px solid #ccc; background:#fff; cursor:pointer; }
    .toolbar button:hover { filter:brightness(.96); }
    @media (max-width:560px){ .toolbar{ top:8px; gap:6px; padding:6px 8px; } .toolbar button{ padding:6px 10px; font-size:13px; } }

    @media print {
      @page { size:B5 portrait; margin:12mm; }
      html, body { background:none !important; margin:0 !important; padding:0 !important; }
      .toolbar { display:none !important; }
      .b5-preview { width:100%; margin:0; padding:0; box-shadow:none; box-sizing:border-box; transform:scale(0.97); transform-origin:top left; }
      table { width:100%; }
      .no-print { display:none !important; } .print-text { display:inline !important; }
      table input, table input[type="date"], .td-measure-grid input { border:none !important; outline:none !important; background:transparent !important; box-shadow:none !important; border-radius:0 !important; }
      .signature-box img[src=""] { display:none !important; }
      .stamp-box-row, .signature-box { display:flex !important; }
      * { -webkit-print-color-adjust:exact; print-color-adjust:exact; }
    }

    .td-measure-grid input.invalid { background:#ffebee; box-shadow:inset 0 0 0 1px #d32f2f; }
    @media print { .td-measure-grid input.invalid { background:transparent !important; box-shadow:none !important; } }

    .serial-wrap { display:grid; grid-template-columns:auto 1fr; align-items:center; gap:1mm; }
    .serial-prefix { white-space:nowrap; }

    .soft-required.pending { background-color:#fff6d8; box-shadow:inset 0 0 0 1px rgba(10, 191, 252, 0.25); transition:background-color .25s ease; }
    @media print { .soft-required.pending { background:transparent !important; box-shadow:none !important; } }

    #lock-overlay{position:fixed;inset:0;background:rgba(255, 255, 255, 0.9);display:none;align-items:center;justify-content:center;z-index:9998;text-align:center;padding:20mm;}
  </style>
</head>
<body>
  <div class="toolbar">
    <button type="button" onclick="printViaPDF()">ğŸ–¨ï¸ å°åˆ·</button>
    <button type="button" onclick="saveToNASFixed()">ğŸ’¾ NASä¿å­˜</button>
    <button type="button" onclick="clearAllFields()">ğŸ§¹ å…¨ã¦ã‚¯ãƒªã‚¢</button>
    <button type="button" onclick="configureNextSerial()">ğŸ”¢ ç•ªå·è¨­å®š</button>
    <button type="button" onclick="configureDigits()">#ï¸âƒ£ æ¡æ•°è¨­å®š</button>
  </div>

  <div id="lock-overlay">
    <div style="max-width:120mm;line-height:1.6;font-size:4.5mm;color:#b91c1c;">
      <div style="font-weight:bold;font-size:5mm;margin-bottom:4mm;">ã“ã®ãƒ•ã‚©ãƒ¼ãƒ ã¯ç¾åœ¨ã€ä»–ã®ç«¯æœ«ã§ç·¨é›†ä¸­ã§ã™</div>
      åˆ¥ç«¯æœ«ã§ä¿å­˜/å°åˆ·ãŒçµ‚ã‚ã‚‹ã¾ã§ãŠå¾…ã¡ãã ã•ã„ã€‚
    </div>
  </div>

  <form id="inspection-form">
    <div class="b5-preview">
      <h2>å‡ºè·æ¤œæŸ»æˆç¸¾æ›¸</h2>

      <!-- HEADER -->
      <table class="header-table">
        <tr>
          <td class="section-label">å®¢å…ˆ</td>
          <td style="width:25%;">ã‚ªãƒ¼ã‚¯ãƒæ ªå¼ä¼šç¤¾ å¾¡ä¸­</td>
          <td class="section-label">ç®¡ç†No.</td>
          <td>TTS60-01-688</td>
          <td class="section-label">ç™ºè¡Œå¹´æœˆæ—¥</td>
          <td><input type="date" name="hakkohiduke" class="no-print soft-required" data-soft-required="1"/><span class="print-text" data-from="hakkohiduke"></span></td>
        </tr>
        <tr>
          <td class="section-label">æ©Ÿç¨®</td><td>MB-66V</td>
          <td class="section-label">å“ç•ª</td><td>H1090-0025-88-4</td>
          <td class="section-label">å›³ç•ª</td><td>2823-20</td>
        </tr>
        <tr>
          <td class="section-label">å“å</td><td>Yè»¸SG</td>
          <td class="section-label">è£½é€ æ—¥</td>
          <td><input type="date" name="makingdate" class="no-print soft-required" data-soft-required="1"/><span class="print-text" data-from="makingdate"></span></td>
          <td class="section-label">è£½é€ No</td>
          <td>
            <div class="serial-wrap no-print"><span class="serial-prefix" data-prefix>Y282320-</span><input type="text" name="serial_no_suffix" inputmode="numeric" placeholder="0001" class="soft-required" data-soft-required="1" readonly /></div>
            <span class="print-text" data-serial-print></span>
          </td>
        </tr>
        <tr class="order-no-row">
          <td class="section-label">ã‚ªãƒ¼ãƒ€ãƒ¼No</td>
          <td class="data" colspan="5"><input type="text" name="order_no" placeholder="ä¾‹: 102P068219-001" class="soft-required" data-soft-required="1"/></td>
        </tr>
      </table>

      <div class="inputter-row no-print">
        <label>å…¥åŠ›è€…</label>
        <select name="inputter" class="soft-required" data-soft-required="1">
          <option value="">- é¸æŠã—ã¦ãã ã•ã„ -</option>
          <option value="é•·è°·éƒ¨">é•·è°·éƒ¨</option><option value="éƒ½åˆ">éƒ½åˆ</option><option value="çŸ³æ©‹">çŸ³æ©‹</option><option value="ãƒ¯ãƒ¼ãƒ¦">ãƒ¯ãƒ¼ãƒ¦</option><option value="ãƒ¦ã‚¹ãƒ•">ãƒ¦ã‚¹ãƒ•</option>
        </select>
      </div>

      <!-- åˆ¤å®š TABLE -->
      <table>
        <tr><th>æ¤œæŸ»é …ç›®</th><th>è¦æ ¼</th><th>åˆ¤å®š</th></tr>
        <tr><td>æœ¬ä½“å–ä»˜ã‘å¯¸æ³•</td><td>æ‘ºå‹•ãƒ†ã‚¹ãƒˆå°å–ä»˜åˆã‚ã›</td><td><select name="judge1" class="no-print judge-select"><option value="">-</option><option>åˆ</option><option>å¦</option></select><span class="print-text"></span></td></tr>
        <tr><td>æ‘ºå‹•ãƒ†ã‚¹ãƒˆ</td><td>æ‘ºå‹•ãƒ†ã‚¹ãƒˆå°èµ°ã‚Šãƒ»æ©Ÿèƒ½ç¢ºèª</td><td><select name="judge2" class="no-print judge-select"><option value="">-</option><option>åˆ</option><option>å¦</option></select><span class="print-text"></span></td></tr>
        <tr><td>æ‘ºå‹•æ™‚ã®ç•°éŸ³</td><td>æ‘ºå‹•ãƒ†ã‚¹ãƒˆå°èµ°ã‚Šæ™‚ç•°éŸ³ã®æœ‰ç„¡ç¢ºèª</td><td><select name="judge3" class="no-print judge-select"><option value="">-</option><option>ç„¡</option><option>æœ‰</option></select><span class="print-text"></span></td></tr>
        <tr><td>å¤–è¦³æ¤œæŸ»</td><td>ã‚­ã‚ºãƒ»ãƒãƒªã®æœ‰ç„¡ç›®è¦–ç¢ºèª</td><td><select name="judge4" class="no-print judge-select"><option value="">-</option><option>åˆ</option><option>å¦</option></select><span class="print-text"></span></td></tr>
        <tr><td>ã‚«ãƒãƒ¼ãƒ¯ã‚¤ãƒ‘ãƒ¼ã®é™¤éš…</td><td>ãƒ¯ã‚¤ãƒ‘ãƒ¼æ t=0.05ã«ã¦ç¢ºèª</td><td><select name="judge5" class="no-print judge-select"><option value="">-</option><option>åˆ</option><option>å¦</option></select><span class="print-text"></span></td></tr>
      </table>

      <!-- æ¸¬å®š TABLE -->
      <table>
        <tr><th>é …ç›®</th><th>åŸºæº–å€¤</th><th>æ¸¬å®šå€¤</th></tr>
        <tr><td>åç¸®æ™‚é•·ã•(a)</td><td>230 mmä»¥ä¸‹</td><td class="td-measure"><div class="td-measure-grid"><input type="text" inputmode="numeric" name="a_length" placeholder="0-230" data-min="0" data-max="230" class="soft-required" data-soft-required="1"/><span>mm</span></div></td></tr>
        <tr><td>ä¼¸é•·æ™‚é•·ã•(b)</td><td>920 mmä»¥ä¸Š</td><td class="td-measure"><div class="td-measure-grid"><input type="text" inputmode="numeric" name="b_length" placeholder=">=920" data-min="920" class="soft-required" data-soft-required="1"/><span>mm</span></div></td></tr>
        <tr><td>ã‚«ãƒãƒ¼ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯(s)</td><td>690 mmä»¥ä¸Š</td><td class="td-measure"><div class="td-measure-grid"><input type="text" inputmode="numeric" name="c_length" placeholder=">=690" data-min="690" class="soft-required" data-soft-required="1"/><span>mm</span></div></td></tr>
        <tr><td>åˆæœŸæ‘ºå‹•æŠµæŠ—</td><td>5.0 kgä»¥ä¸‹</td><td class="td-measure"><div class="td-measure-grid"><input type="text" inputmode="decimal" step="0.1" name="start_resist" placeholder="0-5.0" data-min="0" data-max="5" class="soft-required" data-soft-required="1"/><span>kg</span></div></td></tr>
        <tr><td>ä¸­æœŸæ‘ºå‹•æŠµæŠ—</td><td>4.0 kgä»¥ä¸‹</td><td class="td-measure"><div class="td-measure-grid"><input type="text" inputmode="decimal" step="0.1" name="mid_resist" placeholder="0-4.0" data-min="0" data-max="4" class="soft-required" data-soft-required="1"/><span>kg</span></div></td></tr>
        <tr><td>çµ‚æœŸæ‘ºå‹•æŠµæŠ—</td><td>4.0 kgä»¥ä¸‹</td><td class="td-measure"><div class="td-measure-grid"><input type="text" inputmode="decimal" step="0.1" name="end_resist" placeholder="0-4.0" data-min="0" data-max="4" class="soft-required" data-soft-required="1"/><span>kg</span></div></td></tr>
      </table>

      <!-- ç·åˆåˆ¤å®š -->
      <div style="margin:2mm 0;">
        <label style="font-weight:bold;">ç·åˆåˆ¤å®š</label>
        <select name="final_judgment" class="no-print" style="margin-left:20mm;" disabled>
          <option>åˆæ ¼</option><option>å¦</option>
        </select>
        <span class="print-text"></span>
      </div>
      <div style="margin:2mm 0;">
        <label style="font-weight:bold;">[å‚™è€ƒ]</label>
        <input type="text" name="bikou" value="(t=1.0mm)" style="width:70%;" />
      </div>

      <div class="company-name">æ±äº¬ç²¾å¯†ç™ºæ¢æ ªå¼ä¼šç¤¾</div>
      <div class="stamp-box-row">
        <div>
          <select class="no-print" onchange="updateStampPreview('stamp1',this.value)">
            <option value="">- å°é‘‘é¸æŠ -</option>
            <option value="nakagawa.png">ä¸­å·éƒ¨é•·</option><option value="hasebe.png">é•·è°·éƒ¨</option><option value="ishibashi.png">çŸ³æ©‹</option><option value="togo.png">éƒ½åˆ</option><option value="wahyu.png">ãƒ¯ãƒ¼ãƒ¦</option><option value="yusuf.png">ãƒ¦ã‚¹ãƒ•</option>
          </select>
          <div class="stamp-label">æ¤œå°</div><div class="signature-box"><img id="stamp1" src="" alt=""></div>
        </div>
        <div>
          <select class="no-print" onchange="updateStampPreview('stamp2',this.value)">
            <option value="">- å°é‘‘é¸æŠ -</option>
            <option value="nakagawa.png">ä¸­å·éƒ¨é•·</option><option value="hasebe.png">é•·è°·éƒ¨</option><option value="ishibashi.png">çŸ³æ©‹</option><option value="togo.png">éƒ½åˆ</option><option value="wahyu.png">ãƒ¯ãƒ¼ãƒ¦</option><option value="yusuf.png">ãƒ¦ã‚¹ãƒ•</option>
          </select>
          <div class="stamp-label">æ¤œæŸ»å°</div><div class="signature-box"><img id="stamp2" src="" alt=""></div>
        </div>
      </div>
    </div>
  </form>

  <script>
    /* ==== ç·åˆåˆ¤å®šãƒã‚§ãƒƒã‚¯ ==== */
    function isOverallPass(){
      const v1=document.querySelector('select[name="judge1"]').value;
      const v2=document.querySelector('select[name="judge2"]').value;
      const v3=document.querySelector('select[name="judge3"]').value; // ç„¡=OK
      const v4=document.querySelector('select[name="judge4"]').value;
      const v5=document.querySelector('select[name="judge5"]').value;
      if(!v1||!v2||!v3||!v4||!v5) return null;
      if(!((v1==='åˆ')&&(v2==='åˆ')&&(v3==='ç„¡')&&(v4==='åˆ')&&(v5==='åˆ'))) return false;

      const numFields=[
        {name:"a_length",min:0,max:230},
        {name:"b_length",min:920},
        {name:"c_length",min:690},
        {name:"start_resist",min:0,max:5},
        {name:"mid_resist",min:0,max:4},
        {name:"end_resist",min:0,max:4}
      ];
      for(const f of numFields){
        const el=document.querySelector(`input[name="${f.name}"]`);
        if(!el||!el.value) return null;
        const val=parseFloat(el.value);
        if(isNaN(val)) return false;
        if(f.min!==undefined && val<f.min) return false;
        if(f.max!==undefined && val>f.max) return false;
      }
      return true;
    }
    function updateOverallJudgment(){
      const sel=document.querySelector('select[name="final_judgment"]');
      const span=sel.nextElementSibling;
      const result=isOverallPass();
      if(result===true) sel.value='åˆæ ¼';
      else if(result===false) sel.value='å¦';
      else sel.value='';
      if(span) span.textContent=sel.value;
    }

    /* ==== INIT ==== */
    window.addEventListener('load',()=>{
      document.querySelectorAll('select.judge-select,input[data-soft-required]').forEach(el=>{
        el.addEventListener('change',updateOverallJudgment);
        el.addEventListener('input',updateOverallJudgment);
      });
      updateOverallJudgment();
    });
  </script>
</body>
</html>
